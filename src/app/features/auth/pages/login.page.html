<div class="login-container">
  <div class="login-shell">
    <!-- Panel institucional / marca -->
    <aside class="brand-panel">
      <img
        src="assets/peru.jpg"
        alt="Universidad UPeU"
        class="brand-background"
      />
      <div class="brand-overlay"></div>

      <div class="brand-content">
        <div class="brand-logo-row">
          <img
            src="https://upeu.edu.pe/wp-content/uploads/2022/04/logo-upeu-dark-svg.svg"
            alt="UPeU"
            class="brand-logo"
            onerror="this.style.display='none'"
          />

          <!-- Paso 1: solo nombre de la universidad -->
          <span class="brand-campus" *ngIf="step() === 1">
            Universidad Peruana Uni√≥n
          </span>

          <!-- Paso 2: sede + escuela profesional -->
          <span class="brand-campus" *ngIf="step() === 2">
            {{ sede() || 'Universidad Peruana Uni√≥n' }}
            <ng-container *ngIf="escuela()">
              ‚Ä¢ {{ escuela() }}
            </ng-container>
          </span>
        </div>

        <h2 class="brand-title">
          Plataforma de Vinculaci√≥n con el Medio
        </h2>
        <p class="brand-text">
          Accede a tus proyectos, eventos, registros y certificados en un solo lugar.
        </p>

        <ul class="brand-highlights">
          <li>Gesti√≥n de proyectos y eventos institucionales</li>
          <li>Control de asistencia y participaci√≥n</li>
          <li>Integraci√≥n con expedientes acad√©micos</li>
        </ul>
      </div>
    </aside>

    <!-- Panel de autenticaci√≥n -->
    <main class="auth-panel">
      <div class="auth-card">
        <header class="form-header">
          <div class="form-logo">
            <img
              src="https://upeu.edu.pe/wp-content/uploads/2022/04/logo-upeu-dark-svg.svg"
              alt="UPeU"
              class="main-logo"
              onerror="this.style.display='none'"
            />
          </div>

          <p class="welcome-question">¬øListo para comenzar?</p>
          <h1 class="form-title">{{ title() }}</h1>

          <div class="step-indicator">
            <div class="step-dot" [class.active]="step() === 1">1</div>
            <div class="step-line"></div>
            <div class="step-dot" [class.active]="step() === 2">2</div>
          </div>
        </header>

        <!-- Paso 1: username -->
        <form
          *ngIf="step() === 1"
          [formGroup]="lookupForm"
          (ngSubmit)="submitLookup()"
          class="form-content"
        >
          <div class="input-group">
            <label for="username">Usuario institucional</label>
            <input
              id="username"
              formControlName="username"
              autocomplete="username"
              placeholder="Ej. nombre.apellido"
            />
            <small class="error-text" *ngIf="username.invalid && username.touched">
              Este campo es obligatorio.
            </small>
          </div>

          <button
            type="submit"
            class="primary-btn"
            [disabled]="lookupForm.invalid"
          >
            Continuar
          </button>
        </form>

        <!-- Paso 2: password -->
        <form
          *ngIf="step() === 2"
          [formGroup]="loginForm"
          (ngSubmit)="submitLogin()"
          class="form-content"
        >
          <!-- Resumen de usuario -->
          <div class="user-info-simple">
            <div class="user-avatar">
              <img
                [src]="profilePhoto() || 'assets/photo.svg'"
                alt="Foto de perfil"
              />
            </div>

            <div class="user-details">
              <div class="user-name">{{ fullName() }}</div>
              <div class="user-meta">
                <span *ngIf="escuela()">{{ escuela() }} ‚Ä¢ </span>
                <span>{{ rol() || 'Usuario' }}</span>
              </div>
            </div>

            <button
              type="button"
              class="link-button change-user"
              (click)="back()"
            >
              Cambiar usuario
            </button>
          </div>

          <!-- Mensaje de bloqueo (cuando backend lo indique) -->
          <div *ngIf="isLocked()" class="lock-message">
            <div class="lock-icon">
              <span>üîí</span>
            </div>
            <div class="lock-text">
              <strong>Cuenta temporalmente bloqueada</strong>
              <p>{{ loginError() }}</p>
            </div>
          </div>

          <!-- Campo de contrase√±a -->
          <div class="input-group">
            <label for="password">Contrase√±a</label>
            <div class="password-wrapper">
              <input
                [type]="showPassword() ? 'text' : 'password'"
                id="password"
                formControlName="password"
                autocomplete="current-password"
                placeholder="Ingresa tu contrase√±a"
                class="password-input"
                [class.error]="loginError() && !isLocked()"
                [disabled]="isLocked()"
              />

              <button
                type="button"
                class="toggle-password-btn"
                (click)="togglePasswordVisibility()"
                [disabled]="isLocked()"
                tabindex="-1"
              >
                <span class="password-icon">
                  {{ showPassword() ? 'üôà' : 'üëÅ' }}
                </span>
              </button>
            </div>

            <small
              class="error-text"
              *ngIf="password.invalid && password.touched"
            >
              La contrase√±a es requerida.
            </small>
            <small
              class="error-text"
              *ngIf="loginError() && !isLocked()"
            >
              {{ loginError() }}
            </small>

            <div class="password-actions">
              <a
                href="#"
                class="forgot-password"
                (click)="requestPasswordReset(); $event.preventDefault()"
              >
                ¬øOlvidaste tu contrase√±a?
              </a>
            </div>
          </div>

          <div class="button-row">
            <button
              type="button"
              class="secondary-btn"
              (click)="back()"
            >
              Cambiar usuario
            </button>

            <button
              type="submit"
              class="primary-btn"
              [disabled]="loginForm.invalid || isLocked()"
            >
              {{ isLocked() ? 'Cuenta bloqueada' : 'Ingresar' }}
            </button>
          </div>
        </form>

        <footer class="form-footer">
          <p>
            ¬øNecesitas ayuda?
            <a href="#" class="help-link">Cont√°ctanos</a>
          </p>
        </footer>
      </div>
    </main>
  </div>
</div>
